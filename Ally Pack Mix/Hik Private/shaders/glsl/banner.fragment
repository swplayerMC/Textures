// __multiversion__
#include "fragmentVersionCentroid.h"
#include "uniformShaderConstants.h"

#include "function/tonemap.glsl"

LAYOUT_BINDING(0) uniform sampler2D TEXTURE_0;

#if __VERSION__ >= 300
	_centroid varying vec4 uv;
#else
	varying vec4 uv;
#endif

#ifdef ENABLE_FOG
varying vec4 fogColor;
#endif

#ifdef ENABLE_LIGHT
varying vec4 light;
#endif

#ifndef DISABLE_TINTING
varying vec4 color;
#endif

varying vec4 haze;

void main()
{
	vec4 diffuse = texture2D(TEXTURE_0, uv.xy);
	vec4 base = texture2D(TEXTURE_0, uv.zw);

	#ifndef DISABLE_TINTING
		base.a = mix(diffuse.r * diffuse.a, diffuse.a, color.a);
		base.rgb *= color.rgb;
	#endif

	#ifdef ENABLE_LIGHT
		base.rgb *= light.rgb;
	#endif

	base.rgb = GBias(base.rgb);
	
	#ifdef ENABLE_FOG
		base.rgb = mix( base.rgb, fogColor.rgb, fogColor.a );
	#endif
	base.rgb = mix(base.rgb, haze.rgb, haze.a);

	#ifdef UI_ENTITY
		base.a *= HUD_OPACITY;
	#endif

	gl_FragColor = base;
}